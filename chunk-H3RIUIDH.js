import{C as Lt,D as Gt,E as $t,J as Pt,L as Mt,O as qt,a as jt,d as Ot,e as Vt,h as U,i as A,j as xe,k as Et,q as Rt,s as kt,y as At}from"./chunk-UIFZ3WLV.js";import{a as Nt}from"./chunk-XLFR775L.js";import{Ia as K,Jc as wt,La as St,Qa as vt,Ra as Tt,Sa as Bt,Sc as It,Wc as Q,_a as Dt,gb as xt,pd as z}from"./chunk-YEYQNSO2.js";import{K as lt,N as st,S as dt,V as E,Z as mt,ba as ct,ca as pt,da as ft}from"./chunk-7TAVANMD.js";import{$a as He,A as Ne,Bb as x,Ca as N,Dg as ue,Eb as _,Ec as rt,Eg as he,Gb as p,H as Pe,Ig as nt,Ih as ut,Jf as ot,L as Me,Lh as ht,M as L,Mb as de,Mh as Be,Na as n,Nb as M,Oa as We,Ob as w,Oh as _t,Pb as I,Pg as _e,Rg as ge,Rh as gt,Sg as be,Ta as C,Tg as Ce,Ub as H,Vb as Je,Vg as at,Vh as bt,W as te,Wb as Ze,Wh as Ct,Y as qe,Yg as ye,Yh as yt,_a as V,_g as Fe,a as k,aa as ie,ab as v,ac as me,b as Ve,ba as Qe,bc as Re,bh as Se,ca as ze,cb as P,cc as et,ea as Ue,eb as y,fa as S,fi as De,g as h,gh as ve,gi as Ft,h as W,ib as s,ih as Te,jb as ne,k as Ee,kb as Ke,kc as f,l as Z,lc as u,mc as tt,n as Ge,na as g,oa as b,qb as T,ra as re,sb as ae,ta as oe,tb as le,tc as ce,ub as se,uf as pe,v as $e,va as G,vb as l,vg as fe,wa as $,wb as d,wc as j,xb as F,xc as it,yb as Xe,yd as q,z as ee,zb as Ye}from"./chunk-4ZEFVPJG.js";var R=(()=>{class r{constructor(e){this._fgService=e,this._customFilterConditions=new Map}addCustomFilter(e){if(!e.conditionComponent&&e.rendererComponent&&(e.conditionComponent=e.rendererComponent),!e.conditionComponent)return!1;let t=this._fgService.addComponent(e.conditionComponent,e.types);return t&&this._customFilterConditions.set(e.conditionComponent,e),t&&e.rendererComponent&&this._fgService.addComponent(e.rendererComponent,e.types.map(i=>`${i}-renderer`)),t}getCustomFilterConfiguration(e){let t=this._fgService.getComponentDefinitionByType(e);if(t)return this._customFilterConditions.get(t.component)}getApplicableFilterConditions(e,t=A.STRING){let i=this._fgService.getComponentDefinitionByType(e),o=Et(t);return i&&this._customFilterConditions.get(i.component)?.filterStrategies||o}getDisplayValue(e,t){return h(this,null,function*(){let i=this.getCustomFilterConfiguration(t);if(i?.valueRenderer){let c=i?.valueRenderer(e),D=ot(c),O;return yield D.createSubscription(c,Ut=>{O=Ut}),O}let o=this._normalizeValue(e.value),m=this._normalizeValue(e.value2);switch(e.operator){case"equalTo":return`=${o}`;case"contains":return`*${o}*`;case"between":return`${o}...${m}`;case"beginsWith":return`${o}*`;case"endsWith":return`*${o}`;case"greaterThan":return`>${o}`;case"greaterThanOrEqualTo":return`>=${o}`;case"lessThan":return`<${o}`;case"lessThanOrEqualTo":return`<=${o}`;case"after":return`>${o}`;case"onOrAfter":return`>=${o}`;case"before":return`<${o}`;case"beforeOrOn":return`<=${o}`;default:return`${o}`}})}normalizeConditions(e,t){return h(this,null,function*(){let i=[];for(let o of t){let m=Object.assign({},o);m.displayValue=yield this.getDisplayValue(m,e.guiOptions?.additionalData.type),i.push(m)}return i})}getConditionFieldSelectedVariants(e,t){return h(this,null,function*(){return(yield this.normalizeConditions(e,t)).map(i=>K(i)?i:{label:i.displayValue,value:i})})}transformCollectionFilter(e){return e.filters.map(t=>({operator:t.strategy,value:t.value,value2:t.value2}))}_normalizeValue(e){return Array.isArray(e)?e.map(t=>this._normalizeValue(t)).join(", "):K(e)?e.label:e instanceof xt?e.toDateString():e}static{this.\u0275fac=function(t){return new(t||r)(Ue(Q))}}static{this.\u0275prov=Qe({token:r,factory:r.\u0275fac})}}return r})();function X(r){return Array.isArray(r)&&(r=r.map(a=>X(a))),K(r)?r.value:r}function Xt(r,a){if(r&1&&(l(0,"div",5)(1,"fd-bar-element")(2,"h4",6),H(3),d()()()),r&2){let e=p();n(2),s("headerSize",4),n(),Je(e.config.header)}}function Yt(r,a){if(r&1){let e=x();l(0,"fd-layout-grid")(1,"div",7)(2,"div",8)(3,"fdp-form-generator",11),_("formSubmitted",function(i){g(e);let o=p(2);return b(o._onFormSubmitted(i))}),d()(),l(4,"div",12)(5,"button",13),f(6,"fdTranslate"),_("click",function(){let i=g(e).$index,o=p(2);return b(o.removeCondition(i))}),d()()()()}if(r&2){let e=a.$implicit;n(3),s("formItems",e)("unifiedLayout",!1)("noAdditionalContent",!0),n(2),s("title",u(6,4,"platformSmartFilterBar.defineConditionsRemoveConditionButtonTitle"))}}function Jt(r,a){if(r&1){let e=x();l(0,"form"),le(1,Yt,7,6,"fd-layout-grid",null,ae),l(3,"fd-layout-grid")(4,"div",7)(5,"div",8),H(6,"\xA0"),d(),l(7,"div",9)(8,"button",10),f(9,"fdTranslate"),_("click",function(){g(e);let i=p();return b(i.addCondition())}),d()()()()()}if(r&2){let e=p();n(),se(e._formItems),n(7),s("label",u(9,1,"platformSmartFilterBar.defineConditionsAddConditionButtonLabel"))}}function Zt(r,a){r&1&&(l(0,"div"),F(1,"fd-busy-indicator",14),d()),r&2&&(ne("text-align","center")("margin",1,"rem"),n(),s("loading",!0))}var we=(()=>{class r{constructor(e,t,i){this._dialogRef=e,this._cdr=t,this._smartFilterBarService=i,this.conditionOperatorOptions=[],this._formItems=[],this.loaded=!1,this._conditionLabelKeys={contains:"filterConditionContains",equalTo:"filterConditionEqualTo",between:"filterConditionBetween",beginsWith:"filterConditionBeginsWith",endsWith:"filterConditionEndsWith",lessThan:"filterConditionLessThan",lessThanOrEqualTo:"filterConditionLessThanOrEqualTo",greaterThan:"filterConditionGreaterThan",greaterThanOrEqualTo:"filterConditionGreaterThanOrEqualTo",after:"filterConditionAfter",onOrAfter:"filterConditionOnOrAfter",before:"filterConditionBefore",beforeOrOn:"filterConditionBeforeOrOn"},this._submittedForms=[],this.resolveTranslation=dt(),this._init()}addCondition(){this._formItems.push(this._generateFormGeneratorItems())}removeCondition(e){this._formItems.splice(e,1),this._formItems.length===0&&this.addCondition()}applyConditions(){this._cdr.detectChanges(),this._submittedForms=[],this.formGenerators.toArray().forEach(e=>e.submit())}_onFormSubmitted(e){if(this._submittedForms.push(e),this._submittedForms.length!==this.formGenerators.length)return;let t=this._submittedForms.map(i=>(i.value=i.value1!==void 0?i.value1:i.value,i));this._dialogRef.close(t.filter(i=>i.value!==void 0&&i.value!==null))}_cancel(){this._dialogRef.dismiss()}_init(){this.config=this._dialogRef.data,this.conditionOperatorOptions=this._getApplicableConditionOperators(),this._addExistingConditions(X(this.config.conditions)),this.config.conditions.length===0&&this.addCondition(),this.loaded=!0,this._cdr.markForCheck()}_getApplicableConditionOperators(){let e=this._smartFilterBarService.getApplicableFilterConditions(this.config.filterType,this.config.dataType),t=k({},this._conditionLabelKeys);for(let i of Object.keys(this._conditionLabelKeys)){let o="platformSmartFilterBar."+t[i];t[i]=this.resolveTranslation(o)}return e.map(i=>({label:t[i],value:i}))}_addExistingConditions(e){e.forEach(t=>{let i=this._generateFormGeneratorItems(t);this._formItems.push(i)})}_generateFormGeneratorItems(e){return[{name:"operator",message:"operator",default:e?this.conditionOperatorOptions.find(t=>t.value===e.operator)?.value:this.conditionOperatorOptions[0].value,type:"select",choices:this.conditionOperatorOptions,required:!0,guiOptions:{inline:!1,column:1,noLabelLayout:!0}},{name:"value",message:"value",default:e?.value,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValuePlaceholder"),controlType:this.config.controlType,when:t=>t.operator!==xe.BETWEEN,onchange:(t,i,o)=>{o.parent?.get("value1")?.setValue(t,{emitEvent:!1})},guiOptions:{inline:!1,column:2,noLabelLayout:!0}},{name:"value1",message:"value1",default:e?.value,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValueFromPlaceholder"),controlType:this.config.controlType,when:t=>t.operator===xe.BETWEEN,onchange:(t,i,o)=>{o.parent?.get("value")?.setValue(t,{emitEvent:!1})},guiOptions:{inline:!1,column:2,noLabelLayout:!0}},{name:"value2",message:"value2",default:e?.value2,type:this.config.filterType,choices:this.config.choices,placeholder:this.resolveTranslation("platformSmartFilterBar.filterConditionValueToPlaceholder"),required:!0,controlType:this.config.controlType,when:t=>t?.operator===xe.BETWEEN,guiOptions:{inline:!1,column:3,noLabelLayout:!0}}]}static{this.\u0275fac=function(t){return new(t||r)(C(ue),C(ce),C(R))}}static{this.\u0275cmp=V({type:r,selectors:[["fdp-smart-filter-bar-conditions-dialog"]],viewQuery:function(t,i){if(t&1&&M(z,5),t&2){let o;w(o=I())&&(i.formGenerators=o)}},decls:11,vars:7,consts:[[1,"fdp-smart-filter-bar__conditions-dialog"],["fdkTemplate","header"],[3,"text-align","margin"],["fdType","emphasized",3,"click","label"],["fdType","transparent",3,"click","label"],["fd-bar-left",""],["fd-title","",3,"headerSize"],["fdLayoutGridRow",""],["colGrow","","fdLayoutGridCol",""],["fdLayoutGridCol","",1,"fdp-smart-filter-bar__actions-column"],["fd-button","",3,"click","label"],["columnLayout","XL3-L3-M3-S3",3,"formSubmitted","formItems","unifiedLayout","noAdditionalContent"],["colGrow","","fdLayoutGridCol","",1,"fdp-smart-filter-bar__actions-column"],["fd-button","","fdType","transparent","glyph","decline","type","button",3,"click","title"],[3,"loading"]],template:function(t,i){t&1&&(l(0,"fd-dialog",0)(1,"fd-dialog-header"),y(2,Xt,4,2,"ng-template",1),d(),l(3,"fd-dialog-body"),y(4,Jt,10,3,"form")(5,Zt,2,5,"div",2),d(),l(6,"fd-dialog-footer")(7,"fd-button-bar",3),f(8,"fdTranslate"),_("click",function(){return i.applyConditions()}),d(),l(9,"fd-button-bar",4),f(10,"fdTranslate"),_("click",function(){return i._cancel()}),d()()()),t&2&&(n(4),T(i.loaded?4:5),n(3),s("label",u(8,3,"platformSmartFilterBar.defineConditionsSubmitButtonLabel")),n(2),s("label",u(10,5,"platformSmartFilterBar.defineConditionsCancelButton")))},dependencies:[ve,Se,pe,Ce,be,Fe,he,De,gt,Be,_t,Bt,Tt,vt,z,_e,ye,ge,fe,E],encapsulation:2,changeDetection:0})}}return r})();var zt=(()=>{class r extends Dt{constructor(){super(...arguments),this._dialogService=S(Te),this._smartFilterBarService=S(R),this._injector=S(oe),this.openConditionsDialog=()=>{let e=this.getField().value,t={header:this.formItem.message,dataType:this.formItem.guiOptions?.additionalData.dataType,filterType:this.formItem.guiOptions?.additionalData.type,conditions:e||[],choices:this.formItem.guiOptions?.additionalData.choices,controlType:this.formItem.guiOptions?.additionalData.controlType};this._dialogService.open(we,{data:t,width:"67.5rem",minHeight:"30%"},this._injector).afterClosed.pipe(L(1)).subscribe({next:o=>h(this,null,function*(){let m=this.getField(),c=yield this._smartFilterBarService.getConditionFieldSelectedVariants(this.formItem,o);m.setValue(c)}),error:o=>{}})}}getField(){return this.form.get(`${this.formGroupName}.${this.name}`)}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=re(r)))(i||r)}})()}static{this.\u0275dir=v({type:r,features:[P]})}}return r})();var ke=(()=>{class r{constructor(){this.conditionStrategy="or",this.smartFilterBarFilterable=!0,this.required=!1,this.defaultSelected=!1,this.hasOptions=!1}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275dir=v({type:r,selectors:[["","fdpSmartFilterBarFieldDefinition",""],["","fdp-smart-filter-bar-field-definition",""]],inputs:{key:"key",name:"name",label:"label",filterType:"filterType",dataType:"dataType",customFilterType:"customFilterType",conditionStrategy:"conditionStrategy",smartFilterBarFilterable:[2,"smartFilterBarFilterable","smartFilterBarFilterable",j],required:[2,"required","required",j],defaultSelected:[2,"defaultSelected","defaultSelected",j],hasOptions:[2,"hasOptions","hasOptions",j]}})}}return r})();var ei=(()=>{class r{constructor(e){this._subject=e,this._fieldDefinitionsSubject=new Z([]),this.fieldsStream=this._fieldDefinitionsSubject.asObservable(),this._destroyRef=S(G)}ngAfterViewInit(){this._fieldDefinitions.changes.pipe(te(null),q(this._destroyRef)).subscribe(()=>{this._fieldDefinitionsSubject.next(this._fieldDefinitions.map(e=>this._transformSubjectField(e)))})}getDataSource(){return this._subject.getDataSource()}getSubjectFields(){return this._fieldDefinitions.toArray().map(e=>this._transformSubjectField(e))}getFieldVariants(e){return this.getDataSource().dataProvider.getFieldOptions(e)}getDefaultFields(){return this.getSubjectFields()?.filter(e=>e.filterable&&e.defaultSelected).map(e=>e.name)}getState(){return this._subject.getTableState()}getSubject(){return this._subject}_transformSubjectField(e){return{key:e.key,name:e.name,label:e.label,filterType:e.filterType,filterable:e.smartFilterBarFilterable,dataType:e.dataType,required:e.required,customFilterType:e.customFilterType,defaultSelected:e.defaultSelected,hasOptions:e.hasOptions,conditionStrategy:e.conditionStrategy}}static{this.\u0275fac=function(t){return new(t||r)(C(jt))}}static{this.\u0275dir=v({type:r,selectors:[["","fdpSmartFilterBarSubject",""],["","fdp-smart-filter-bar-subject",""]],contentQueries:function(t,i,o){if(t&1&&de(o,ke,4),t&2){let m;w(m=I())&&(i._fieldDefinitions=m)}},exportAs:["fdp-smart-filter-bar-subject"]})}}return r})();var Ae=(()=>{class r{constructor(e){this.templateRef=e}static{this.\u0275fac=function(t){return new(t||r)(C(We))}}static{this.\u0275dir=v({type:r,selectors:[["","fdpSmartFilterBarToolbarItem",""]]})}}return r})();var ti=()=>[],ii=()=>["submitted"],Ie=(()=>{class r extends zt{static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=re(r)))(i||r)}})()}static{this.\u0275cmp=V({type:r,selectors:[["fdp-smart-filter-bar-condition-field"]],features:[P],decls:4,vars:14,consts:[[3,"formGroup"],[3,"formGroupName"],["displayKey","displayValue",3,"id","addOnButtonClickFn","dataSource","formControlName","name","placeholder","validationStrategy","glyphAriaLabel"]],template:function(t,i){t&1&&(Xe(0,0)(1,1),F(2,"fdp-multi-input",2),f(3,"fdTranslate"),Ye()()),t&2&&(s("formGroup",i.form),n(),s("formGroupName",i.formGroupName),n(),s("id",i.id)("addOnButtonClickFn",i.openConditionsDialog)("dataSource",i.formItem.choices||Re(12,ti))("formControlName",i.name)("name",i.name)("placeholder",i.formItem.placeholder||i.formItem.message)("validationStrategy",Re(13,ii))("glyphAriaLabel",u(3,10,"platformSmartFilterBar.manageFieldConditions")))},dependencies:[De,ht,Be,Ft,bt,yt,Ct,wt,E],encapsulation:2})}}return r})();var je=class extends kt{constructor(a){super(a)}filter(a){let e;switch(a){case"visible":e=this._getVisibleItems();break;case"active":e=this._getActiveItems();break;case"visibleAndActive":e=this._getVisibleAndActiveItems();break;case"mandatory":e=this._getMandatoryItems();break;case"all":default:e=this._getAllItems();break}this.items$.next(e)}_getAllItems(){return this.items}_getVisibleItems(){return this.items.filter(a=>a.visible)}_getActiveItems(){return this.items.filter(a=>a.active)}_getVisibleAndActiveItems(){return this.items.filter(a=>a.visible||a.active)}_getMandatoryItems(){return this.items.filter(a=>a.mandatory)}};var ri=["table"];function oi(r,a){r&1&&(l(0,"div",7)(1,"fd-bar-element")(2,"h4",8),H(3),f(4,"fdTranslate"),d()()(),l(5,"div",9)(6,"fd-bar-element"),F(7,"fdp-table-reset-button"),d()()),r&2&&(n(2),s("headerSize",4),n(),Ze(" ",u(4,2,"platformSmartFilterBar.selectFiltersHeader")," "))}function ni(r,a){r&1&&F(0,"fd-icon",16)}function ai(r,a){if(r&1&&(l(0,"fdp-table-cell"),y(1,ni,1,0,"fd-icon",16),d()),r&2){let e=a.$implicit;n(),T(e.active?1:-1)}}function li(r,a){if(r&1){let e=x();l(0,"fdp-table",10,0),_("rowSelectionChange",function(i){g(e);let o=p();return b(o._onRowSelectionChange(i))}),l(2,"fdp-table-toolbar",11),f(3,"fdTranslate"),l(4,"fdp-table-toolbar-actions")(5,"fdp-select",12),_("selectionChange",function(i){g(e);let o=p();return b(o._onFilterVisibilityChange(i))}),d()()(),F(6,"fdp-column",13),f(7,"fdTranslate"),l(8,"fdp-column",14),f(9,"fdTranslate"),y(10,ai,2,1,"fdp-table-cell",15),d()()}if(r&2){let e=p();s("dataSource",e.source),n(2),s("hideItemCount",!1)("title",u(3,7,"platformSmartFilterBar.selectFiltersAvailableFiltersText")),n(3),s("list",e._filterVisibilityOptions)("value",e._filterVisibilityOptions[0].value),n(),s("label",u(7,9,"platformSmartFilterBar.selectFiltersFilterColumnLabel")),n(2),s("label",u(9,11,"platformSmartFilterBar.selectFiltersActiveColumnLabel"))}}function si(r,a){r&1&&(l(0,"div"),F(1,"fd-busy-indicator",17),d()),r&2&&(ne("text-align","center")("margin",1,"rem"),n(),s("loading",!0))}var Oe=(()=>{class r{constructor(e,t,i){this._dialogRef=e,this._language$=t,this._cdr=i,this._filterVisibilityOptions=[],this.loaded=!1,this.isResetAvailable$=N(!1),this._categoryLabelKeys={all:"settingsCategoryAll",visible:"settingsCategoryVisible",active:"settingsCategoryActive",visibleAndActive:"settingsCategoryVisibleAndActive",mandatory:"settingsCategoryMandatory"},this._selectedFilters=[],this._destroyRef=S(G),this._translationResolver=new st,this.setInitialTableState(),this._init()}ngAfterViewInit(){this.setSelectedFilters()}setSelectedFilters(){this._sourceSubscription?.unsubscribe(),this._sourceSubscription=this.source.open().pipe($e(Ge),q(this._destroyRef)).subscribe(e=>{e.forEach((t,i)=>{t.visible&&this.table.toggleSelectableRow(i)})})}reset(){this.setInitialTableState(),this.setSelectedFilters()}setInitialTableState(){this._availableFields=this._dialogRef.data.fields.filter(e=>e.filterable).map(e=>({label:e.label,active:!!this._dialogRef.data.filterBy.find(t=>t.field===e.name),mandatory:e.required,visible:this._dialogRef.data.selectedFilters.includes(e.name),key:e.key,name:e.name})),this.source=new Rt(new je(this._availableFields))}_cancel(){this._dialogRef.dismiss()}_confirm(){this._dialogRef.close(this._selectedFilters)}_onRowSelectionChange(e){this._selectedFilters=e.selection.map(t=>t.name),this.isResetAvailable$.set(!0)}_onFilterVisibilityChange(e){this.table&&(this.source.dataProvider.filter(e.payload),this.source.fetch(this.table.getTableState()))}_init(){return h(this,null,function*(){yield this._transformVisibilityLabels(),this.loaded=!0,this._cdr.markForCheck()})}_transformVisibilityLabels(){return h(this,null,function*(){let e=yield ee(this._language$),t=k({},this._categoryLabelKeys);for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let o="platformSmartFilterBar."+t[i];t[i]=this._translationResolver.resolve(e,o)}for(let[i,o]of Object.entries(t))this._filterVisibilityOptions.push({label:o,value:i})})}static{this.\u0275fac=function(t){return new(t||r)(C(ue),C(lt),C(ce))}}static{this.\u0275cmp=V({type:r,selectors:[["fdp-smart-filter-bar-settings-dialog"]],viewQuery:function(t,i){if(t&1&&M(ri,5),t&2){let o;w(o=I())&&(i.table=o.first)}},features:[me([{provide:Lt,useExisting:r}])],decls:11,vars:7,consts:[["table",""],[1,"fdp-table-p13-filtering-dialog"],["fdkTemplate","header"],["selectionMode","multiple",3,"dataSource"],[3,"text-align","margin"],["fdType","emphasized",3,"click","label"],["fdType","transparent",3,"click","label"],["fd-bar-left",""],["fd-title","",3,"headerSize"],["fd-bar-right",""],["selectionMode","multiple",3,"rowSelectionChange","dataSource"],[3,"hideItemCount","title"],[3,"selectionChange","list","value"],["align","start","key","label","name","label",3,"label"],["align","center","key","active","name","active","width","150px",3,"label"],[4,"fdpCellDef"],["glyph","accept"],[3,"loading"]],template:function(t,i){t&1&&(l(0,"fd-dialog",1)(1,"fd-dialog-header"),y(2,oi,8,4,"ng-template",2),d(),l(3,"fd-dialog-body"),y(4,li,11,13,"fdp-table",3)(5,si,2,5,"div",4),d(),l(6,"fd-dialog-footer")(7,"fd-button-bar",5),f(8,"fdTranslate"),_("click",function(){return i._confirm()}),d(),l(9,"fd-button-bar",6),f(10,"fdTranslate"),_("click",function(){return i._cancel()}),d()()()),t&2&&(n(4),T(i.loaded?4:5),n(3),s("label",u(8,3,"platformSmartFilterBar.selectFiltersSubmitButtonLabel")),n(2),s("label",u(10,5,"platformSmartFilterBar.selectFiltersCancelButton")))},dependencies:[ve,Se,pe,Ce,be,Fe,at,Gt,he,qt,At,Mt,Pt,It,$t,Vt,Ot,nt,ye,ge,fe,E],encapsulation:2,changeDetection:0})}}return r})();var Le="smart-filter-condition-renderer";var Y=(()=>{class r{constructor(){this.name="platformSmartFilterBar",this.presetChanged=new $}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275dir=v({type:r,inputs:{name:"name"},outputs:{presetChanged:"presetChanged"}})}}return r})();var di=r=>({filtersCount:r});function mi(r,a){}function ci(r,a){if(r&1&&(l(0,"div",7),y(1,mi,0,0,"ng-template",8),d()),r&2){let e=a.$implicit;n(),s("ngTemplateOutlet",e)}}function pi(r,a){if(r&1&&(le(0,ci,2,1,"div",7,ae),F(2,"fd-toolbar-separator")),r&2){let e=p(2);se(e._toolbarItems)}}function fi(r,a){if(r&1){let e=x();l(0,"button",9),f(1,"fdTranslate"),_("click",function(){g(e);let i=p(2);return b(i.submitForm())}),d()}if(r&2){let e=p(2);s("disabled",e.loading)("label",u(1,2,"platformSmartFilterBar.submitButtonLabel"))}}function ui(r,a){if(r&1){let e=x();l(0,"fd-toolbar",0),y(1,pi,3,0),l(2,"fdp-search-field",2),f(3,"fdTranslate"),_("inputChange",function(i){g(e);let o=p();return b(o.onSearchInputChange(i))})("searchSubmit",function(){g(e);let i=p();return b(i.submitForm())})("cancelSearch",function(){g(e);let i=p();return b(i.cancelSearch())}),d(),F(4,"fd-toolbar-spacer"),y(5,fi,2,4,"button",3),l(6,"button",4),f(7,"fdTranslate"),_("click",function(){g(e);let i=p();return b(i.submitForm())}),d(),l(8,"button",5),f(9,"fdTranslate"),_("click",function(){g(e);let i=p();return b(i.showFilteringSettings())}),d(),l(10,"button",6),f(11,"fdTranslate"),_("click",function(){g(e);let i=p();return b(i.toggleFilterBar())}),d()()}if(r&2){let e=p();s("shouldOverflow",!0),n(),T(e._toolbarItems?1:-1),n(),s("disabled",e.loading)("disableRefresh",!0)("placeholder",u(3,12,"platformSmartFilterBar.searchPlaceholder")),n(3),T(e.liveUpdate?-1:5),n(),s("disabled",e.loading)("ariaLabel",u(7,14,"platformSmartFilterBar.refreshButtonAriaLabel")),n(2),s("label",tt(9,16,"platformSmartFilterBar.filtersButtonLabel",et(21,di,e.selectedFiltersCount$())))("disabled",e.loading),n(2),s("label",u(11,19,e.showFilterBar$()?"platformSmartFilterBar.hideFiltersButtonLabel":"platformSmartFilterBar.showFiltersButtonLabel"))("disabled",e.loading)}}function hi(r,a){if(r&1){let e=x();l(0,"div",1)(1,"fdp-form-generator",10),_("formCreated",function(){g(e);let i=p();return b(i._onFormCreated())})("formSubmitted",function(i){g(e);let o=p();return b(o._onFormSubmitted(i))}),d()()}if(r&2){let e=p();s("hidden",!e.showFilterBar$()),n(),s("noAdditionalContent",!0)("formItems",a)("columnLayout",e.filtersColumnLayout)}}var _i="XL4-L3-M2-S1";function gi(r){return Math.max(...r.split("-").map(a=>{let e=a.match(/\d+/);return e?parseInt(e[0],10):1}))}var bi={responsivePadding:!0,verticalPadding:!0,minWidth:"30rem",bodyMinHeight:"calc(50vh - 5.5rem)"},Ci={provide:Y,useExisting:ie(()=>J)},J=(()=>{class r extends Y{set subject(e){this._setSubject(e)}get subject(){return this._subject}get loading(){return this._subject?.getDataSource()?this._subject.getDataSource().isDataLoading:!0}constructor(e,t,i,o){super(),this._dialogService=e,this._fgService=t,this._injector=i,this._destroyRef=o,this.transparent=!1,this.filtersColumnLayout=_i,this.liveUpdate=!1,this.hideToolbar=!1,this.smartFiltersChanged=new $,this.smartFiltersApplied=new $,this.searchInputChanged=new $,this.filterBy=[],this.showFilterBar$=N(!0),this._toolbarItems=[],this._formItems=N(null),this.selectedFilters$=N([]),this.selectedFiltersCount$=it(()=>this.selectedFilters$().length),this._subscriptions=new W,this._subjectSubscriptions=new W,this._formGeneratorReady=new Z(!1),this._ignorePresetChange=!1,this._refresh$=new Ee,this._smartFilterBarService=S(R,{optional:!0,skipSelf:!0})??S(R,{self:!0}),this._fgService.addComponent(Ie,[Le])}ngAfterViewInit(){this._subscriptions.add(this._toolbarItemRefs.changes.pipe(te(null)).subscribe(()=>{this._toolbarItems=this._toolbarItemRefs.toArray().map(e=>e.templateRef)}))}ngOnDestroy(){this._subscriptions.unsubscribe(),this._unsubscribeFromSubject(),this._refresh$.next(),this._refresh$.complete()}getDisplayValue(e,t){return h(this,null,function*(){return this._smartFilterBarService.getDisplayValue(e,t)})}showFilteringSettings(){let t={fields:this._getSubjectDefinitions(),filterBy:this.filterBy,selectedFilters:this.selectedFilters$()};this._dialogService.open(Oe,Ve(k({},bi),{disablePaddings:!0,width:"50rem",data:t}),this._injector).afterClosed.pipe(L(1)).subscribe({next:o=>{this._setSelectedFilters(o)},error:()=>{}})}onSearchInputChange(e){this.search=e,this.searchInputChanged.emit(e)}cancelSearch(){this.search=void 0,this.liveUpdate&&this.submitForm()}submitForm(){this._formGenerator.submit()}setPreset(e){return h(this,null,function*(){this._ignorePresetChange=!0,e.filterBy=e.filterBy||[],this.filterBy=e.filterBy,this.search=e.search,this._refresh$.next(),this._refresh$.complete(),this._refresh$=new Ee,this._formGeneratorReady.pipe(Pe(t=>t),qe(this._refresh$)).subscribe(()=>h(this,null,function*(){this._fgService.resetForm(this._formGenerator.form);for(let i of this.filterBy){let o=this._fgService.getFormControl(this._formGenerator.form,i.field);if(!o)continue;let m=o.formItem,c=this._smartFilterBarService.transformCollectionFilter(i),D=yield this._smartFilterBarService.getConditionFieldSelectedVariants(m,c);o?.setValue(D)}this._setSelectedFilters(this.filterBy.map(i=>i.field)),this.subject.getDataSource().dataProvider.setFilters(this.filterBy,this.search),this.subject.getSubject().fetch()}))})}getCurrentPreset(){return{search:this.search,filterBy:this.filterBy}}_onFormSubmitted(e){let t=this._generateCollectionFilterGroups(e);this._applyFiltering(t)}_onFormCreated(){this.subject&&this._setSelectedFilters([...this.subject.getDefaultFields(),...this.selectedFilters$()]),this._formGenerator.form.valueChanges.pipe(Me(50),q(this._destroyRef)).subscribe(()=>h(this,null,function*(){let e=yield this.getFormattedConditions();this.smartFiltersChanged.emit({filterBy:e,search:this.search,subject:this.subject}),this.liveUpdate&&this._applyFiltering(e)})),this._formGeneratorReady.next(!0)}toggleFilterBar(){this.showFilterBar$.update(e=>!e)}getFormattedConditions(){return h(this,null,function*(){let e=yield this._fgService.getFormValue(this._formGenerator.form);return this._generateCollectionFilterGroups(e)})}_generateCollectionFilterGroups(e){let t=[],i=this._getSubjectDefinitions();return Object.entries(e).filter(([,o])=>!!o).forEach(([o,m])=>{let c=i.find(O=>O.name===o),D={filters:[],strategy:c.conditionStrategy,field:c.key};m.forEach(O=>{D.filters.push({strategy:O.operator,field:c.key,value:O.value,value2:O.value2,type:c.dataType})}),t.push(D)}),t.filter(o=>o.filters?.length>0)}_setSubject(e){e&&(this._subject=e,this.unsubscribeFromSubject(),this._listenToSubjectColumns())}unsubscribeFromSubject(){this._subject&&this._subjectSubscriptions.unsubscribe()}_listenToSubjectColumns(){this._subjectSubscriptions=new W,this._subjectSubscriptions.add(this._subject.fieldsStream.subscribe(e=>h(this,null,function*(){yield this._generateForm(e.filter(t=>t.filterable))})))}_generateForm(e){return h(this,null,function*(){let t=[],i=gi(this.filtersColumnLayout??""),o=1;e.length!==0&&(e.forEach(m=>{let c=this._generateBaseFieldItem(m);switch(m.required&&this.selectedFilters$.update(D=>(D.push(m.name),D)),m.filterType){case U.SINGLE:case U.CATEGORY:c.guiOptions.additionalData.type="select",c.guiOptions.inline=!1;break;case U.MULTI:c.guiOptions.additionalData.type="multi-input";break;case U.CUSTOM:c=this._generateCustomFilterFieldItem(m,c);break;case U.INPUT:default:c=this._generateInputFieldItem(m,c);break}c.guiOptions.column=o,o+=1,o>i&&(o=1),t.push(c)}),this._formItems.set(t))})}_generateCustomFilterFieldItem(e,t){return e.customFilterType&&(t.guiOptions.additionalData.type=e.customFilterType,t.guiOptions.additionalData=Object.assign(t.guiOptions.additionalData,this._smartFilterBarService.getCustomFilterConfiguration(e.customFilterType)),t.type=t.guiOptions.additionalData.rendererComponent?`${t.guiOptions.additionalData.type}-renderer`:t.type,t.transformer=t.guiOptions.additionalData.valueTransformer),t}_generateInputFieldItem(e,t){switch(e.dataType){case A.DATE:t.guiOptions.additionalData.type="datepicker";break;case A.NUMBER:t.guiOptions.additionalData.controlType="number";break;case A.BOOLEAN:case A.STRING:default:t.guiOptions.additionalData.controlType="text";break}return t}_generateBaseFieldItem(e){return{name:e.name,message:e.label,required:e.required,type:Le,placeholder:" ",validators:e.required?[ut.required]:[],choices:e.hasOptions?this._getFilterDefaultOptions(e.key,e.filterType):void 0,transformer:t=>X(t),guiOptions:{additionalData:{type:"input",dataType:e.dataType,filterType:e.filterType,controlType:"text",choices:e.hasOptions?this._getFilterAvailableOptions(e.key):void 0}},when:()=>this.selectedFilters$().includes(e.name)}}_getFilterAvailableOptions(e){return()=>this._getFieldVariants(e)}_getFilterDefaultOptions(e,t){return()=>h(this,null,function*(){let i=yield ee(this._getFieldVariants(e).pipe(L(1))),o=[];for(let m of i){let c={value:m.value,operator:"equalTo"};c.displayValue=yield this.getDisplayValue(c,t),o.push(c)}return o})}_getFieldVariants(e){return this.subject.getFieldVariants(e).pipe(L(1),Ne(t=>t.filter((i,o)=>t.findIndex(m=>m.value===i.value)===o)))}_getSubjectDefinitions(){return this.subject?.getSubjectFields()||[]}_applyFiltering(e){let t=this.subject.getDataSource();this.filterBy=e,t.dataProvider.setFilters(e,this.search),this.subject.getSubject().fetch();let i={search:this.search,filterBy:this.filterBy};this.smartFiltersApplied.emit(Ve(k({},i),{subject:this._subject})),this._ignorePresetChange||this.presetChanged.emit(i),this._ignorePresetChange=!1}_unsubscribeFromSubject(){this._subjectSubscriptions.unsubscribe(),this._subjectSubscriptions=new W}_setSelectedFilters(e){this.selectedFilters$.set(e.filter((t,i)=>e.indexOf(t)===i)),this._formGenerator.refreshStepsVisibility()}static{this.\u0275fac=function(t){return new(t||r)(C(Te),C(Q),C(oe),C(G))}}static{this.\u0275cmp=V({type:r,selectors:[["fdp-smart-filter-bar"]],contentQueries:function(t,i,o){if(t&1&&de(o,Ae,4),t&2){let m;w(m=I())&&(i._toolbarItemRefs=m)}},viewQuery:function(t,i){if(t&1&&M(z,5),t&2){let o;w(o=I())&&(i._formGenerator=o.first)}},hostAttrs:[1,"fdp-smart-filter-bar"],hostVars:2,hostBindings:function(t,i){t&2&&Ke("fdp-smart-filter-bar--transparent",i.transparent)},inputs:{subject:"subject",transparent:[2,"transparent","transparent",j],filtersColumnLayout:"filtersColumnLayout",liveUpdate:[2,"liveUpdate","liveUpdate",j],hideToolbar:[2,"hideToolbar","hideToolbar",j]},outputs:{smartFiltersChanged:"smartFiltersChanged",smartFiltersApplied:"smartFiltersApplied",searchInputChanged:"searchInputChanged"},features:[me([Ci,R,Q,{provide:St,useExisting:r}]),P],decls:2,vars:2,consts:[["fdType","transparent",3,"shouldOverflow"],["fd-toolbar-item","",1,"fdp-smart-filter-bar__filters",3,"hidden"],["fd-toolbar-item","",3,"inputChange","searchSubmit","cancelSearch","disabled","disableRefresh","placeholder"],["fd-button","","fdType","emphasized","fd-toolbar-item","",3,"disabled","label"],["fd-button","","fd-toolbar-item","","glyph","synchronize",3,"click","disabled","ariaLabel"],["fd-button","","fd-toolbar-item","",3,"click","label","disabled"],["fd-button","","fdType","transparent","fd-toolbar-item","",3,"click","label","disabled"],["fd-toolbar-item",""],[3,"ngTemplateOutlet"],["fd-button","","fdType","emphasized","fd-toolbar-item","",3,"click","disabled","label"],[3,"formCreated","formSubmitted","noAdditionalContent","formItems","columnLayout"]],template:function(t,i){if(t&1&&y(0,ui,12,23,"fd-toolbar",0)(1,hi,2,4,"div",1),t&2){let o;T(i.hideToolbar?-1:0),n(),T((o=i._formItems())?1:-1,o)}},dependencies:[ft,rt,ct,Nt,pt,_e,mt,z,E],styles:[`.fdp-smart-filter-bar{display:block;box-shadow:var(--sapContent_HeaderShadow);background-color:var(--sapObjectHeader_Background)}.fdp-smart-filter-bar--transparent{background-color:var(--sapToolbar_Background);box-shadow:none}.fdp-smart-filter-bar .fd-toolbar--title{height:3rem;min-height:3rem;border-bottom:none;padding:.5rem}@media (min-width: 600px){.fdp-smart-filter-bar .fd-toolbar--title{padding-left:2rem;padding-right:2rem}}.fdp-smart-filter-bar .fd-toolbar fdp-search-field{min-width:15.5rem}.fdp-smart-filter-bar .fdp-smart-filter-bar__filters{padding-left:.5rem;padding-right:.5rem}@media (min-width: 600px){.fdp-smart-filter-bar .fdp-smart-filter-bar__filters{padding-left:2rem;padding-right:2rem}}.fdp-smart-filter-bar .fd-container.fd-form-layout-grid-container{padding:0}.fdp-smart-filter-bar .fd-container.fd-form-layout-grid-container .fd-row .fd-form-group{padding-left:.25rem!important;padding-right:.25rem!important}.fdp-smart-filter-bar__conditions-dialog .fdp-smart-filter-bar__actions-column{min-width:auto;flex:0 0 auto}.fdp-smart-filter-bar__conditions-dialog .fd-popover-custom{display:block}.fdp-smart-filter-bar__conditions-dialog .fd-dialog__body{padding:0 .5rem;background-color:var(--sapBackgroundColor, #f7f7f7)}.fdp-smart-filter-bar__conditions-dialog .fd-container.fd-form-layout-grid-container,.fdp-smart-filter-bar__conditions-dialog .fd-container.fd-form-layout-grid-container .fd-row .fd-form-group{padding-top:0!important;padding-bottom:0!important}.fdp-smart-filter-bar .fd-toolbar{--fdToolbar_Border: none}
`],encapsulation:2,changeDetection:0})}}return r})();var Yo={provide:Y,useExisting:ie(()=>J)};var ln=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=He({type:r})}static{this.\u0275inj=ze({imports:[J,Oe,we,Ie]})}}return r})();export{R as a,zt as b,ke as c,ei as d,Ae as e,J as f,Yo as g,ln as h};
