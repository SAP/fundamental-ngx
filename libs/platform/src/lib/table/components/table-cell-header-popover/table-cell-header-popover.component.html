<fd-popover
    [disabled]="disabled"
    [noArrow]="true"
    fd-table-popover
    [focusAutoCapture]="true"
    [focusTrapped]="true"
    *ngIf="!popoverTemplate; else projectedPopover"
    [triggers]="_headerPopoverTriggers"
    (isOpenChange)="_popoverOpened($event)"
>
    <fdp-list [noBorder]="true" [navigated]="true">
        <li fdp-free-content-list-item *ngFor="let item of _popoverItems$.asObservable() | async">
            <ng-template [ngTemplateOutlet]="item" [ngTemplateOutletContext]="{ popover: popover }"></ng-template>
        </li>
    </fdp-list>
</fd-popover>
<ng-template #projectedPopover>
    <ng-template
        [ngTemplateOutlet]="popoverTemplate!"
        [ngTemplateOutletContext]="{ $implicit: _popoverItems$.asObservable() }"
    ></ng-template>
</ng-template>

<ng-container *ngIf="column?.sortable">
    <ng-template fdkTemplate="sortingAscPopoverItem" let-popover="popover">
        <a
            fd-list-link
            [focusable]="true"
            role="button"
            (click)="_setColumnHeaderSortBy(column.key, SORT_DIRECTION.ASC)"
            (keydown.enter)="_setColumnHeaderSortBy(column.key, SORT_DIRECTION.ASC)"
        >
            <span fd-list-icon glyph="sort-ascending"></span>
            <span fd-list-title>{{ 'platformTable.headerMenuSortAsc' | fdTranslate }}</span>
        </a>
    </ng-template>
    <ng-template fdkTemplate="sortingDescPopoverItem" let-popover="popover">
        <a
            fd-list-link
            [focusable]="true"
            role="button"
            (click)="_setColumnHeaderSortBy(column.key, SORT_DIRECTION.DESC)"
            (keydown.enter)="_setColumnHeaderSortBy(column.key, SORT_DIRECTION.DESC)"
        >
            <span fd-list-icon glyph="sort-descending"></span>
            <span fd-list-title>{{ 'platformTable.headerMenuSortDesc' | fdTranslate }}</span>
        </a>
    </ng-template>
</ng-container>

<ng-container *ngIf="column?.groupable">
    <ng-template fdkTemplate="groupPopoverItem" let-popover="popover">
        <a
            fd-list-link
            [focusable]="true"
            role="button"
            (click)="_setColumnHeaderGroupBy(column.key)"
            (keydown.enter)="_setColumnHeaderGroupBy(column.key)"
        >
            <span fd-list-title>{{ 'platformTable.headerMenuGroup' | fdTranslate }}</span>
        </a>
    </ng-template>
</ng-container>

<ng-container *ngIf="column?.freezable || column?.endFreezable">
    <ng-template fdkTemplate="freezePopoverItem" let-popover="popover">
        <ng-container *ngIf="!columnFrozen; else unfreezeTpl">
            <a fd-list-link [focusable]="true" (click)="_freeze()" role="button" (keydown.enter)="_freeze()">
                <span fd-list-title>
                    {{
                        (!column.endFreezable
                            ? columnIndex > 0
                                ? 'platformTable.headerMenuFreezePlural'
                                : 'platformTable.headerMenuFreeze'
                            : 'platformTable.headerMenuEndFreeze'
                        ) | fdTranslate
                    }}</span
                >
            </a>
        </ng-container>
        <ng-template #unfreezeTpl>
            <a fd-list-link [focusable]="true" (click)="_unFreeze()" role="button" (keydown.enter)="_unFreeze()">
                <span fd-list-title>{{
                    (columnIndex > 0 ? 'platformTable.headerMenuUnfreezePlural' : 'platformTable.headerMenuUnfreeze')
                        | fdTranslate
                }}</span>
            </a>
        </ng-template>
    </ng-template>
</ng-container>

<ng-container *ngIf="column?.filterable && !filteringFromHeaderDisabled">
    <ng-template fdkTemplate="filteringPopoverItem" let-popover="popover">
        <a fd-list-link style="cursor: auto" [focusable]="true">
            <i fd-list-icon glyph="filter"></i>
            <div fd-form-item [horizontal]="true" (click)="$event.stopPropagation()">
                <label fd-form-label [for]="'fdp-table-column-filtering-' + column.name">{{
                    'platformTable.headerMenuFilter' | fdTranslate
                }}</label>
                <input
                    fd-form-control
                    [id]="'fdp-table-column-filtering-' + column.name"
                    (keydown.enter)="_setColumnHeaderFilterBy(column.key, $any($event.target)?.value)"
                />
            </div>
        </a>
    </ng-template>
</ng-container>
