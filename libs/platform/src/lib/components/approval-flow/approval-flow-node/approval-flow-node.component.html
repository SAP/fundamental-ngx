<ng-container *ngIf="!blank">
    <div *ngIf="renderArrow" class="approval-flow-node__arrow"></div>
    <div *ngIf="renderCarouselStartMarker" class="approval-flow-node__carousel-start-marker"></div>
    <div *ngIf="renderCarouselEndMarker" class="approval-flow-node__carousel-end-marker"></div>
    <div *ngIf="isEdit" class="approval-flow-node__edit-controls" (click)="$event.stopPropagation()">
        <fd-checkbox
            [(ngModel)]="_isSelected"
            [compact]="true"
            [disabled]="_isEditActionsAvailable"
            (ngModelChange)="_onCheck(_isSelected)"
        ></fd-checkbox>
        <button
            class="approval-flow-node__menu-button"
            fd-button
            fdType="transparent"
            glyph="overflow"
            [compact]="true"
            [fdMenuTrigger]="menu"
            [disabled]="_isEditActionsAvailable"
        ></button>

        <fd-menu #menu [compact]="true" placement="bottom-end">
            <li fd-menu-item (click)="menu.close(); onAdd.emit('before')">
                <div fd-menu-interactive>Add approvers before</div>
            </li>
            <li fd-menu-item (click)="menu.close(); onAdd.emit('after')">
                <div fd-menu-interactive>Add approvers after</div>
            </li>
            <li fd-menu-item (click)="menu.close(); onAdd.emit('parallel')">
                <div fd-menu-interactive>Add parallel approvers</div>
            </li>
            <li fd-menu-item (click)="menu.close(); onEdit.emit()" *ngIf="_isNotStarted">
                <div fd-menu-interactive>Edit</div>
            </li>
            <li fd-menu-item (click)="menu.close(); onDelete.emit()">
                <div fd-menu-interactive>Delete</div>
            </li>
        </fd-menu>
    </div>
    <div class="approval-flow-node__inner">
        <div class="approval-flow-node__avatar">
            <ng-container *ngIf="node.approvers.length === 1">
                <fd-avatar [image]="node.approvers[0].imgUrl" size="xs" [circle]="true"></fd-avatar>
            </ng-container>
            <ng-container *ngIf="node.approvers.length > 1">
                <fd-avatar [label]="node.description" size="xs" [circle]="true"></fd-avatar>
            </ng-container>
        </div>
        <div class="approval-flow-node__info">
            <div
                class="approval-flow-node__name"
                [class.approval-flow-node__name--members-count]="node.approvers.length > 1"
                i18n="@@platformApprovalFlowNodeMembers">
                {
                    node.approvers.length,
                    plural,
                    =1 {{{node.approvers[0].name}}}
                    other {{{node.approvers.length}} members}
                }
            </div>
            <div class="approval-flow-node__description">
                {{ node.approvers.length > 1 ? node.description : node.approvers[0].description }}
            </div>
            <fdp-object-status
                [status]="_objectStatus"
                inverted="true">
                {{ node.status }}
            </fdp-object-status>
        </div>
    </div>
    <ng-container *ngIf="true">
        <span style="position: absolute; font-size: 11px; right: 0; top: 0; ">{{ node.id }} </span>
        <span *ngIf="parent" style="position: absolute; font-size: 11px; left: 0; top: 0; color: orangered;">Parent - {{ parent.id }} </span>
        <span *ngIf="node.targets.length" style="position: absolute; font-size: 11px; right: 0; bottom: 0; color: orange">Targets - {{ node.targets }}</span>
    </ng-container>
</ng-container>
<ng-container *ngIf="isEdit && (blank || canAddNodeBefore || canAddNodeAfter)">
    <ng-container *ngTemplateOutlet="addNodeButton"></ng-container>
</ng-container>
<ng-template #addNodeButton>
    <button
        class="approval-flow-node__add"
        [class.approval-flow-node__add--blank]="blank"
        [class.approval-flow-node__add--before]="!blank && canAddNodeBefore"
        [class.approval-flow-node__add--after]="!blank && canAddNodeAfter"
        [style.visibility]="_isDropZoneActive ? 'hidden' : ''"
        (click)="$event.stopPropagation(); onAdd.emit('after')"
    >
        <fd-icon glyph="add"></fd-icon>
    </button>
    <div class="approval-flow-node__drop-zone" [class.approval-flow-node__drop-zone--active]="_isDropZoneActive" #dropZone *ngIf="blank"></div>
</ng-template>
