<ng-template let-dialog let-dialogConfig="dialogConfig" #container>
    <fd-dialog [dialogConfig]="dialogConfig" [dialogRef]="dialog">
        <fd-dialog-header>
            <ng-template fdTemplate="header">
                <ng-container *ngTemplateOutlet="mobile ? mobileDialogTitle : desktopDialogTitle"></ng-container>
                <ng-container *ngIf="!mobile">
                    <ng-container *ngTemplateOutlet="advancedSearchContent"></ng-container>
                </ng-container>
            </ng-template>
        </fd-dialog-header>
        <fd-dialog-body>
            <div class="fdp-value-help-dialog__content-holder">
                <ng-container *ngIf="mobile">
                    <ng-container *ngTemplateOutlet="advancedSearchContent"></ng-container>
                </ng-container>

                <ng-container *ngIf="selectedTab === _tabTypes.selectFromList">
                    <ng-container *ngTemplateOutlet="selectionContent"></ng-container>
                </ng-container>

                <ng-container *ngIf="selectedTab === _tabTypes.defineConditions">
                    <ng-container *ngTemplateOutlet="defineConditionsContent"></ng-container>
                </ng-container>
            </div>
        </fd-dialog-body>
        <fd-dialog-footer>
            <ng-template fdTemplate="footer">
                <div
                    class="fdp-value-help-dialog__row fdp-value-help-dialog__selection-row"
                    aria-label="Selected and excluded items"
                    i18n-aria-label="@@platformI18nValueHelpDialogSelectionBarLabel"
                    *ngIf="!isMobileAdvancedSearchActive"
                >
                    <fd-toolbar fdType="transparent" [clearBorder]="true" (click)="toggleSelectedPanel()">
                        <button
                            fd-button
                            aria-label="Toggle Selected and excluded items"
                            fdType="transparent"
                            [glyph]="_selectedExpandState ? 'navigation-down-arrow' : 'navigation-right-arrow'"></button>
                        <!-- Selected title -->
                        <ng-container *ngIf="excludedItems.length || selectedItems.length; else noItemsPanelTitle">
                            <ng-container *ngIf="selectedItems.length">
                                <ng-container *ngTemplateOutlet="selectedPanelTitle"></ng-container>
                            </ng-container>
                            <!-- Divider for close state -->
                            <ng-container *ngIf="!_selectedExpandState && excludedItems.length && selectedItems.length">/</ng-container>
                            <!-- Excluded title -->
                            <ng-container *ngIf="(!_selectedExpandState || !selectedItems.length) && excludedItems.length">
                                <ng-container *ngTemplateOutlet="excludedPanelTitle"></ng-container>
                            </ng-container>
                        </ng-container>
                    </fd-toolbar>
                    <div *ngIf="_selectedExpandState">
                        <div class="fdp-value-help-dialog__tokens" *ngIf="selectedItems.length">
                            <fd-toolbar [shouldOverflow]="true">
                                <fd-token
                                    fd-toolbar-item
                                    fdOverflowPriority="high"
                                    class="fdp-value-help-dialog__selection-token"
                                    [compact]="true"
                                    (onCloseClick)="removeSelected(item)"
                                    *ngFor="let item of selectedItems"
                                >{{ !!tokenizerFn ? (item | displayFnPipe: tokenizerFn) : item[tokenViewField] }}
                                </fd-token>
                            </fd-toolbar>
                            <button
                                (click)="clearSelectedItems()"
                                class="fdp-value-help-dialog__tokens-clear"
                                fd-button
                                fdType="transparent"
                                glyph="sys-cancel"
                                i18n-aria-label="@@platformI18nValueHelpDialogClearSelectedAriaLabel"
                                aria-label="clear selected items"></button>
                        </div>
                        <ng-container *ngIf="excludedItems.length">
                            <ng-container *ngIf="selectedItems.length">
                                <ng-container *ngTemplateOutlet="excludedPanelTitle"></ng-container>
                            </ng-container>
                            <div class="fdp-value-help-dialog__tokens">
                                <fd-toolbar [shouldOverflow]="true">
                                    <button
                                        fd-button
                                        fd-toolbar-item
                                        fdOverflowPriority="high"
                                        [compact]="true"
                                        *ngFor="let item of excludedItems"
                                    >{{ !!tokenizerFn ? (item | displayFnPipe: tokenizerFn) : item[tokenViewField] }}</button>
                                </fd-toolbar>
                                <fd-toolbar [shouldOverflow]="true">
                                    <fd-token
                                        fd-toolbar-item
                                        fdOverflowPriority="high"
                                        class="fdp-value-help-dialog__selection-token"
                                        [compact]="true"
                                        (onCloseClick)="removeExcluded(item)"
                                        *ngFor="let item of excludedItems"
                                    >{{ !!tokenizerFn ? (item | displayFnPipe: tokenizerFn) : item[tokenViewField] }}
                                    </fd-token>
                                </fd-toolbar>
                                <button
                                    (click)="clearExcludedItems()"
                                    class="fdp-value-help-dialog__tokens-clear"
                                    fd-button
                                    fdType="transparent"
                                    glyph="sys-cancel"
                                    i18n-aria-label="@@platformI18nValueHelpDialogClearExcludedAriaLabel"
                                    aria-label="clear excluded items"></button>
                            </div>
                        </ng-container>
                    </div>
                </div>
                <div class="fdp-value-help-dialog__actions-row">
                    <button
                        fd-button
                        i18n-label="@@platformI18nValueHelpDialogSearchButton"
                        label="Go"
                        fdType="emphasized"
                        *ngIf="mobile && isOpenAdvanced"
                        [compact]="true"
                        (click)="onSearchAdvanced()"
                    ></button>
                    <button
                        fd-button
                        i18n-label="@@platformI18nValueHelpDialogSuccessButton"
                        label="OK"
                        fdType="emphasized"
                        *ngIf="selectedTab !== _tabTypes.advancedSearch"
                        [compact]="true"
                        (click)="success()"></button>
                    <button
                        fd-button
                        i18n-label="@@platformI18nValueHelpDialogCancelButton"
                        label="Cancel"
                        fdType="transparent"
                        [compact]="true"
                        (click)="dismiss()"></button>
                </div>
            </ng-template>
        </fd-dialog-footer>
    </fd-dialog>
</ng-template>

<ng-template #selectedPanelTitle>
    <span i18n="@@platformI18nValueHelpDialogSelectedItemsLabel">Selected items</span> ({{ selectedItems.length }})
</ng-template>
<ng-template #excludedPanelTitle>
    <span i18n="@@platformI18nValueHelpDialogExcludedItemsLabel">Excluded items</span> ({{ excludedItems.length }})
</ng-template>
<ng-template #noItemsPanelTitle>
    <span i18n="@@platformI18nValueHelpDialogEmptySelectedLabel">No items selected</span>
</ng-template>

<ng-template #advancedSearchContent>
    <ng-container *ngIf="isSelectionTab">
        <form
            class="fdp-value-help-dialog__row fdp-value-help-dialog__advanced-search"
            aria-label ="Selectid filters"
            [id]="'advanced-search-' + id"
            (ngSubmit)="onSearch()"
        >
            <fd-layout-grid *ngIf="!mobile || (mobile && !isOpenAdvanced)">
                <div fdLayoutGridCol="12" colMd="12" [colLg]="mobile ? 12: 6" [colXl]="mobile ? 12: 6">
                    <div fd-form-item>
                        <input
                            fd-form-control
                            type="search"
                            [(ngModel)]="_mainSearch"
                            name="value-help-dialog-search"
                            id="value-help-dialog-search"
                            [placeholder]="searchField.placeholder" />
                    </div>
                </div>

                <div fdLayoutGridCol="12" colMd="12" [colLg]="mobile ? 12: 6" [colXl]="mobile ? 12: 6" *ngIf="_hasAdvanced" class="fdp-value-help-dialog__advanced-actions">
                    <button
                        fd-button
                        fdType="transparent"
                        [label]="mobile ? searchField.advancedSearchLabel : (isOpenAdvanced ? searchField.hideAdvancedSearchLabel : searchField.showAdvancedSearchLabel)"
                        [compact]="true"
                        (click)="toggleAdvancedSearch()"
                    ></button>
                    <button
                        type="submit"
                        fd-button
                        i18n-label="@@platformI18nValueHelpDialogSearchButton"
                        label="Go"
                        fdType="emphasized"
                        [compact]="true"
                    ></button>
                </div>
            </fd-layout-grid>
            <div
                ariaLabel="Selected Panel Content"
                [id]="'advanced-search-content-' + id"
                *ngIf="isOpenAdvanced && _hasAdvanced"
            >
                <fd-layout-grid class="fdp-value-help-dialog__advanced-filters">
                    <ng-container *ngFor="let filter of _displayedFilters; trackBy: _trackByFilterFn">
                        <ng-container *ngIf="filter.advanced">
                            <div fdLayoutGridCol="12" colMd="12" colLg="6" colXl="6">
                                <fd-layout-grid [noGap]="true">
                                    <div fdLayoutGridCol="12" colMd="12" colLg="4" colXl="4">
                                        <label fd-form-label [for]="'input' + filter.key">{{ filter.label }}:</label>
                                    </div>
                                    <div fdLayoutGridCol="12" colMd="12" colLg="8" colXl="8">
                                        <input [(ngModel)]="filter.value" fd-form-control type="text" [name]="'search-by-' + filter.label" [id]="'input' + filter.key" />
                                    </div>
                                </fd-layout-grid>
                            </div>
                        </ng-container>
                    </ng-container>
                </fd-layout-grid>
            </div>
        </form>
    </ng-container>
</ng-template>

<ng-template #selectionContent>
    <div class="table-header">
        <h4><span i18n="@@platformI18nValueHelpDialogDisplayCountLabel">Items</span> ({{ _displayedData.length }})</h4>
    </div>
    <ng-container *ngIf="_displayedFilters.length; else emptyFilters">
        <ng-content select="fdp-select-tab-settings"></ng-content>
    </ng-container>
</ng-template>

<ng-template #defineConditionsContent></ng-template>

<ng-template #dialogTitleText>
    <ng-container>{{ dialogTitle }}</ng-container>
</ng-template>

<ng-template #tabLink let-title="title" let-type="type">
    <ng-container *ngIf="selectedTab === type">
        <button fd-button glyph="navigation-left-arrow" fdType="transparent" (click)="switchTab()"></button>
        <h4 fd-title>{{ title }}</h4>
    </ng-container>
    <ng-container *ngIf="selectedTab !== type">
        <a fd-list-link (click)="switchTab(type)">
            <span fd-list-title>{{ title }}</span>
            <i fd-list-icon glyph="navigation-right-arrow"></i>
        </a>
    </ng-container>
</ng-template>

<ng-template #advancedHeader>
    <button fd-button glyph="navigation-left-arrow" fdType="transparent" (click)="toggleAdvancedSearch()"></button>
    <h4 fd-title>{{ searchField.advancedSearchLabel }}</h4>
</ng-template>

<ng-template #desktopDialogTitle>
    <div fd-dialog-title>
        <ng-container *ngTemplateOutlet="dialogTitleText"></ng-container>
    </div>
    <ng-container *ngTemplateOutlet="desktopTabs"></ng-container>
</ng-template>

<ng-template #mobileDialogTitle>
    <div fd-dialog-title>
        <ng-container *ngIf="hasSelectedTab; else dialogTitleText">
            <ng-container *ngTemplateOutlet="selectedTabHeader"></ng-container>
        </ng-container>
    </div>
    <ng-container *ngTemplateOutlet="mobileTabs"></ng-container>
</ng-template>

<ng-template #desktopTabs>
    <fd-tab-list class="fdp-value-help-dialog__tabs" [(selectedIndex)]="selectedTab">
        <fd-tab [title]="selectionTab.title" tabState="information" *ngIf="hasSelectionTab"></fd-tab>
        <fd-tab [title]="defineTab.title" tabState="information" *ngIf="hasDefineTab"></fd-tab>
    </fd-tab-list>
</ng-template>

<ng-template #mobileTabs>
    <ul fd-list [compact]="true" size="s" [byline]="true" *ngIf="!hasSelectedTab">
        <li fd-list-item *ngIf="hasSelectionTab">
            <ng-container *ngTemplateOutlet="tabLink, context: {title: selectionTab.title, type: _tabTypes.selectFromList}"></ng-container>
        </li>
        <li fd-list-item *ngIf="hasDefineTab">
            <ng-container *ngTemplateOutlet="tabLink, context: {title: defineTab.title, type: _tabTypes.defineConditions}"></ng-container>
        </li>
    </ul>
</ng-template>

<ng-template #selectedTabHeader>
    <ng-container [ngSwitch]="selectedTab">
        <ng-container *ngSwitchCase="_tabTypes.selectFromList">
            <ng-container *ngTemplateOutlet="tabLink, context: {title: 'Select from list', type: selectedTab}"></ng-container>
        </ng-container>
        <ng-container *ngSwitchCase="_tabTypes.advancedSearch">
            <ng-container *ngTemplateOutlet="advancedHeader"></ng-container>
        </ng-container>
        <ng-container *ngSwitchCase="_tabTypes.defineConditions">
            <ng-container *ngTemplateOutlet="tabLink, context: {title: defineTab.title, type: selectedTab}"></ng-container>
        </ng-container>
    </ng-container>
</ng-template>
