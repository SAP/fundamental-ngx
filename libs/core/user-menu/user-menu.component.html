@if (!mobile()) {
    <fd-popover
        [isOpen]="isOpen()"
        (isOpenChange)="isOpenChangeHandle($event)"
        [focusAutoCapture]="true"
        [restoreFocusOnClose]="true"
        [focusTrapped]="true"
        [disableScrollbar]="true"
    >
        <fd-popover-control>
            <ng-container *ngTemplateOutlet="control"></ng-container>
        </fd-popover-control>
        <fd-popover-body fd-user-menu-popover-control>
            <div class="fd-user-menu__popover-wrapper">
                <div
                    fd-popover-body-header
                    class="fd-user-menu__scroll-header"
                    [class.hidden]="isUserNameVisible()"
                    role="presentation"
                    aria-hidden="true"
                >
                    <ng-container *ngTemplateOutlet="header"></ng-container>
                </div>

                <ng-container *ngTemplateOutlet="body"></ng-container>

                <div fd-popover-body-footer>
                    <ng-container *ngTemplateOutlet="footer"></ng-container>
                </div>
            </div>
        </fd-popover-body>
    </fd-popover>
} @else {
    <span (click)="openDialog(dialogTemplate)">
        <ng-container *ngTemplateOutlet="control"></ng-container>
    </span>

    <ng-template [fdDialogTemplate] let-dialog let-dialogConfig="dialogConfig" #dialogTemplate>
        <fd-dialog [dialogConfig]="dialogConfig" [dialogRef]="dialog">
            <fd-dialog-header>
                @if (userMenuBody()?.bodyHeader()) {
                    <ng-template fdkTemplate="header">
                        <ng-container
                            *ngTemplateOutlet="userMenuBody()?.bodyHeader() ?? null; context: { dialogRef: dialog }"
                        >
                        </ng-container>
                    </ng-template>
                }
            </fd-dialog-header>
            <fd-dialog-body style="padding: 0">
                <ng-container *ngTemplateOutlet="body"></ng-container>
            </fd-dialog-body>
            <fd-dialog-footer>
                <ng-template fdkTemplate="customFooter">
                    <ng-container *ngTemplateOutlet="footer"></ng-container>
                </ng-template>
            </fd-dialog-footer>
        </fd-dialog>
    </ng-template>
}

<ng-template #control>
    <ng-content select="fd-user-menu-control" />
</ng-template>

<ng-template #header>
    <div fd-popover-body-header>
        <div fd-bar barDesign="header">
            <div fd-bar-middle>
                <fd-bar-element>
                    <div
                        class="fd-user-menu__user-name fd-user-menu__user-name--truncate"
                        [innerHTML]="userNameContent()"
                    ></div>
                </fd-bar-element>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #body>
    <ng-content select="fd-user-menu-body" />
</ng-template>

<ng-template #footer>
    <ng-content select="fd-user-menu-footer" />
</ng-template>
