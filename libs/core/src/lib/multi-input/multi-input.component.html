<div class="fd-multi-input fd-multi-input-custom">
    <div class="fd-multi-input-field">
        <fd-popover [isOpen]="open && displayedValues && displayedValues.length"
                    (isOpenChange)="openChangeHandle($event)"
                    [triggers]="[]"
                    [disabled]="disabled"
                    [closeOnOutsideClick]="true"
                    [fillControlMode]="fillControlMode"
                    class="fd-multi-input-popover-custom">
            <fd-popover-control>
                <fd-input-group
                    [state]="state"
                    [buttonFocusable]="buttonFocusable"
                    [button]="true"
                    [glyph]="glyph"
                    [disabled]="disabled"
                    (click)="openChangeHandle(!open)">
                    <fd-tokenizer [compact]="compact" class="fd-multi-input-tokenizer">
                        <fd-token
                            *ngFor="let token of selected"
                            [disabled]=this.disabled
                            (onCloseClick)="handleSelect(false, token, null)">
                            <span [innerHtml]="token | displayFnPipe:displayFn"></span>
                        </fd-token>
                        <input type="text" class="fd-input fd-tokenizer__input fd-multi-input-tokenizer-input"
                               fd-form-control fd-input-group-input
                               #searchInputElement
                               [placeholder]="placeholder"
                               [(ngModel)]="searchTerm"
                               (ngModelChange)="handleSearchTermChange()"
                               (keydown)="handleInputKeydown($event)">
                    </fd-tokenizer>
                </fd-input-group>
            </fd-popover-control>
            <fd-popover-body [attr.aria-hidden]="!open">
                <fd-menu class="fd-multi-input-menu-overflow"
                         *ngIf="displayedValues && displayedValues.length"
                         [style.maxHeight]="maxHeight">
                    <ul fd-menu-list>
                        <li *ngFor="let value of displayedValues; let ind  = index">
                            <label (click)="handleSelect(selected.indexOf(value) === -1, value, $event)" fd-menu-item (keydown)="handleKeyDown($event, ind)">
                                <fd-checkbox [ngModel]="selected ? selected.indexOf(value) !== -1 : false"
                                             class="fd-multi-input-checkbox">
                                    <span [innerHtml]="value | displayFnPipe:displayFn | highlight:searchTerm:highlight"></span>
                                </fd-checkbox>
                            </label>
                        </li>
                    </ul>
                </fd-menu>
                <ng-content></ng-content>
            </fd-popover-body>
        </fd-popover>
    </div>
</div>
