<div class="fd-slider" [class.is-disabled]="disabled">
    <div class="fd-slider__inner" (mouseenter)="_showPopovers()" (mouseleave)="_hidePopovers()">
        <div class="fd-slider__track" (click)="onTrackClick($event)" #track>
            <ng-container *ngIf="!_isRange">
                <div *ngIf="!hideProgressBar" class="fd-slider__track-range" [style.width.%]="_progress"></div>
                <div #handle
                     class="fd-slider__handle"
                     tabindex="0"
                     role="slider"
                     aria-label="slider"
                     [fdPopover]="singleSliderPopover"
                     [triggers]="[]"
                     [closeOnOutsideClick]="false"
                     [appendTo]="handle"
                     placement="top"
                     [attr.aria-valuemin]="min"
                     [attr.aria-valuemax]="max"
                     [attr.aria-valuenow]="_value"
                     [style.left.%]="!_isRtl ? _progress : null"
                     [style.right.%]="_isRtl ? _progress : null"
                     (mousedown)="onHandleClick($event); $event.stopPropagation()"
                     (keydown)="onKeyDown($event)"
                ></div>
            </ng-container>

            <ng-container *ngIf="_isRange">
                <div *ngIf="!hideProgressBar"
                     class="fd-slider__track-range"
                     [style.width.%]="_rangeProgress"
                     [style.left.%]="!_isRtl ? _handle1Position < _handle2Position ? _handle1Position : _handle2Position : null"
                     [style.right.%]="_isRtl ? _handle1Position < _handle2Position ? _handle1Position : _handle2Position : null"
                ></div>

                <div #rangeHandle1
                     class="fd-slider__handle"
                     tabindex="0"
                     role="slider"
                     aria-label="slider"
                     [fdPopover]="rangeSliderPopover1"
                     [triggers]="[]"
                     [closeOnOutsideClick]="false"
                     [appendTo]="rangeHandle1"
                     placement="top"
                     [attr.aria-valuemin]="min"
                     [attr.aria-valuemax]="max"
                     [attr.aria-valuenow]="_handle1Value"
                     [style.left.%]="!_isRtl ? _handle1Position : null"
                     [style.right.%]="_isRtl ? _handle1Position : null"
                     (mousedown)="onHandleClick($event); $event.stopPropagation()"
                     (keydown)="onKeyDown($event)"
                ></div>

                <div #rangeHandle2
                     class="fd-slider__handle"
                     tabindex="0"
                     role="slider"
                     aria-label="slider"
                     [fdPopover]="rangeSliderPopover2"
                     [triggers]="[]"
                     [closeOnOutsideClick]="false"
                     [appendTo]="rangeHandle2"
                     placement="top"
                     [attr.aria-valuemin]="min"
                     [attr.aria-valuemax]="max"
                     [attr.aria-valuenow]="_handle2Value"
                     [style.left.%]="!_isRtl ? _handle2Position : null"
                     [style.right.%]="_isRtl ? _handle2Position : null"
                     (mousedown)="onHandleClick($event); $event.stopPropagation()"
                     (keydown)="onKeyDown($event)"
                ></div>
            </ng-container>
        </div>

        <div class="fd-slider__tick-wrapper">
            <div class="fd-slider__ticks" style="height: 1rem" (click)="onTrackClick($event)">
                <ng-container *ngIf="showTicks">
                    <ng-container *ngFor="let tick of _tickMarks; let first = first; let last = last;">
                        <div
                            class="fd-slider__tick"
                            [style.left.%]="!_isRtl ? (tick.value / (max - min)) * 100 : null"
                            [style.right.%]="_isRtl ? (tick.value / (max - min)) * 100 : null"
                            [class.fd-slider__tick--in-range]="
                            !hideProgressBar &&
                            (_isRange ? (tick.value >= value[0] && tick.value <= value[1]) : tick.value <= value)
                        "
                        ></div>
                    </ng-container>
                </ng-container>
            </div>

            <div class="fd-slider__labels" *ngIf="showTicks && showTicksLabels">
                <div
                    *ngFor="let tick of _tickMarks; let i = index"
                    class="fd-slider__label"
                    [style.left.%]="!_isRtl ? (tick.value / (max - min)) * 100 : null"
                    [style.right.%]="_isRtl ? (tick.value / (max - min)) * 100 : null"
                >{{ tick.label }}
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #singleSliderPopover>
    <ng-container *ngTemplateOutlet="popoverInner; context: { target: _sliderValueTargets.SINGLE_SLIDER }"></ng-container>
</ng-template>

<ng-template #rangeSliderPopover1>
    <ng-container *ngTemplateOutlet="popoverInner; context: { target: _sliderValueTargets.RANGE_SLIDER1 }"></ng-container>
</ng-template>

<ng-template #rangeSliderPopover2>
    <ng-container *ngTemplateOutlet="popoverInner; context: { target: _sliderValueTargets.RANGE_SLIDER2 }"></ng-container>
</ng-template>

<ng-template #popoverInner let-target="target">
    <div class="fd-slider--tooltip-wrapper" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()">
        <div *ngIf="tooltipMode === 'readonly'" class="fd-slider--tooltip">{{ _popoverValueRef[target] }}</div>
        <input
            #popoverInputField
            tabindex="-1"
            type="text"
            [disabled]="disabled"
            class="fd-input fd-slider--tooltip {{ _popoverInputFieldClass }}"
            *ngIf="tooltipMode === 'editable'"
            [(ngModel)]="_popoverValueRef[target]"
            (blur)="_updateValueFromInput(popoverInputField.value, target)"
            (keydown.enter)="_updateValueFromInput(popoverInputField.value, target)">
    </div>
</ng-template>
