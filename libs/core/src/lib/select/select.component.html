<fd-popover
    [(isOpen)]="isOpen"
    [triggers]="[]"
    [appendTo]="appendTo"
    [options]="popperOptions"
    [disabled]="disabled || loading || readonly"
    [fillControlMode]="fillControlMode"
    (isOpenChange)="isOpenChangeHandle($event)">

    <fd-popover-control>
        <div class="fd-select"
             [class.fd-select--compact]="compact">
            <div class="fd-select__control"
                 tabindex="0"
                 #selectControl
                 [ngClass]="state ? 'is-' + state : ''"
                 [class.is-disabled]="disabled"
                 [class.is-readonly]="readonly"
                 [attr.aria-expanded]="isOpen"
                 [attr.aria-disabled]="disabled"
                 [attr.aria-readonly]="readonly"
                 [attr.aria-controls]="controlId"
                 [attr.aria-haspopup]="!disabled && !readonly && !loading"
                 (click)="toggle()">

                <ng-container *ngTemplateOutlet="controlTemplate ? controlTemplate : defaultSelectContent; context: {$implicit: selectValue}"></ng-container>

                <ng-template #defaultSelectContent>
                    {{ selectValue }}
                </ng-template>

                <button fd-button
                        tabindex="-1"
                        class="fd-button--transparent fd-select__button"
                        *ngIf="!readonly"
                        [disabled]="disabled || loading"
                        [glyph]="glyph">
                </button>
            </div>
        </div>
        <fd-busy-indicator *ngIf="loading" [loading]="true" size="m" ></fd-busy-indicator>
    </fd-popover-control>

    <fd-popover-body [attr.aria-controls]="controlId"
                     [style.maxHeight]="maxHeight || calculatedMaxHeight + 'px'">
        <ng-container *ngTemplateOutlet="selectOptionsTemplate"></ng-container>
    </fd-popover-body>
</fd-popover>

<ng-template #selectOptionsTemplate>
    <ul fd-list
        [compact]="compact"
        [dropdownMode]="true"
        [hasMessage]="stateMessage">

        <li fd-list-message *ngIf="stateMessage" [type]="state">
            {{stateMessage}}
        </li>

        <ng-content></ng-content>

    </ul>
</ng-template>

<ng-template let-modal #selectMobileModal>
    <fd-modal-header>
        <h1 fd-modal-title>Select option</h1>
        <button fd-modal-close-btn (click)="modal.dismiss('x')"></button>
    </fd-modal-header>
    <fd-modal-body>
        <ng-container *ngTemplateOutlet="selectOptionsTemplate"></ng-container>
    </fd-modal-body>
</ng-template>
